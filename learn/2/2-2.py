import pandas as pd

# 1. 原始数据准备（模拟燃料棒生产记录）
data = {
    '燃料棒编号': ['FR-2023-001-U', 'FR-2023-002-M', 'FR-2023-003-U', 
                'FR-2023-004-U', 'FR-2023-005-M', 'FR-2023-006-U'],
    '生产信息': ['2023-10-01,一车间,合格', '2023-10-03,二车间,合格',
               '2023-10-05,一车间,待检测', '2023-10-07,三车间,合格',
               '2023-10-09,二车间,不合格', '2023-10-11,一车间,合格'],
    '铀浓度': ['4.5%', '7.2%', '4.8%', '5.0%', '8.1%', '4.7%'],
    '长度(mm)': ['3800', '3802', '3799', '3801', '3798', '3800'],
    '检测数据': ['102.5,0.003', '98.7,0.002', '101.3,0.004', 
               '99.8,0.003', '105.2,0.005', '100.1,0.002']
}
df = pd.DataFrame(data)
print("=== 原始数据 ===")
print(df, "\n")


# 2. 数据类型转换
df['铀浓度'] = df['铀浓度'].str.replace('%', '').astype(float)  # 字符串转浮点
df['长度(mm)'] = df['长度(mm)'].astype(int)  # 字符串转整数
print("=== 2. 数据类型转换后 ===")
print(df[['燃料棒编号', '铀浓度', '长度(mm)']], "\n")


# 3. 字段抽取（从编号提取信息）
# 使用原始字符串r避免正则转义警告
df['生产年份'] = df['燃料棒编号'].str.slice(3,7).astype(int)  # 提取4位年份
#df['生产年份'] = df['燃料棒编号'].str.extract(r'(\d{4})').astype(int)  # 提取4位年份
df['燃料类型'] = df['燃料棒编号'].str.extract(r'-(U|M)$').replace({'U': 'UO2', 'M': 'MOX'})  # 提取燃料类型
print("=== 3. 字段抽取后 ===")
print(df[['燃料棒编号', '生产年份', '燃料类型']], "\n")


# 4. 字段拆分（拆分生产信息）
df[['生产日期', '生产车间', '质量状态']] = df['生产信息'].str.split(',', expand=True)
df['生产日期'] = pd.to_datetime(df['生产日期'])  # 转换为日期类型
df = df.drop(columns=['生产信息'])  # 删除原始合并字段
print("=== 4. 字段拆分后 ===")
print(df[['燃料棒编号', '生产日期', '生产车间', '质量状态']], "\n")


# 5. 重置索引（按生产日期排序后）
df = df.sort_values('生产日期').reset_index(drop=True)  # 排序并重置索引
df_with_index = df.copy()
df_with_index['新索引'] = df.index  # 显式添加索引列用于展示
print("=== 5. 按日期排序并重置索引后 ===")
print(df_with_index[['新索引', '燃料棒编号', '生产日期']], "\n")


# 6. 记录抽取（筛选合格的UO2燃料）
qualified_uo2 = df[(df['燃料类型'] == 'UO2') & (df['质量状态'] == '合格')]
print("=== 6. 合格的UO2燃料记录 ===")
print(qualified_uo2[['燃料棒编号', '燃料类型', '质量状态']], "\n")


# 7. 随机抽取（2条样本用于复检）
random_samples = df.sample(n=2, random_state=42)  # random_state保证结果可复现
print("=== 7. 随机抽取的复检样本 ===")
print(random_samples[['燃料棒编号', '生产车间', '质量状态']])
